let result = {
  "id": "cirqaqcdk0000p8sxxcxr0rwb",
  "error": null,
  "payloads": [{
    "ref": "refs/heads/master",
    "before": "82f50c452d74ae25b4e9e844b511b8337a0ff6c7",
    "after": "4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
    "created": false,
    "deleted": false,
    "forced": false,
    "base_ref": null,
    "compare": "https://github.com/Cloudoki/cn-hyper-test/compare/82f50c452d74…4bb1b2d59a19",
    "commits": [{
      "id": "4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "tree_id": "72d5417d328d5255bb6f2b1f5acf1025198e19a4",
      "distinct": true,
      "message": "fix bug",
      "timestamp": "2016-06-08T10:31:15+01:00",
      "url": "https://github.com/Cloudoki/cn-hyper-test/commit/4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "author": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "committer": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "added": [

      ],
      "removed": [

      ],
      "modified": [
        "conf/tests/cn-hyper-test/index.js"
      ]
    }, {
      "id": "4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "tree_id": "72d5417d328d5255bb6f2b1f5acf1025198e19a4",
      "distinct": true,
      "message": "fix bug",
      "timestamp": "2016-06-08T10:31:15+01:00",
      "url": "https://github.com/Cloudoki/cn-hyper-test/commit/4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "author": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "committer": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "added": [

      ],
      "removed": [

      ],
      "modified": [
        "conf/tests/cn-hyper-test/index.js"
      ]
    }, {
      "id": "4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "tree_id": "72d5417d328d5255bb6f2b1f5acf1025198e19a4",
      "distinct": true,
      "message": "fix bug",
      "timestamp": "2016-06-08T10:31:15+01:00",
      "url": "https://github.com/Cloudoki/cn-hyper-test/commit/4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "author": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "committer": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "added": [

      ],
      "removed": [

      ],
      "modified": [
        "conf/tests/cn-hyper-test/index.js"
      ]
    }],
    "head_commit": {
      "id": "4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "tree_id": "72d5417d328d5255bb6f2b1f5acf1025198e19a4",
      "distinct": true,
      "message": "fix bug",
      "timestamp": "2016-06-08T10:31:15+01:00",
      "url": "https://github.com/Cloudoki/cn-hyper-test/commit/4bb1b2d59a19ecf3319fa99fcd552f276e69b59e",
      "author": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "committer": {
        "name": "Edgar Ribeiro",
        "email": "edgar.marques.ribeiro@gmail.com",
        "username": "efmr"
      },
      "added": [

      ],
      "removed": [

      ],
      "modified": [
        "conf/tests/cn-hyper-test/index.js"
      ]
    },
    "repository": {
      "id": 60270865,
      "name": "cn-hyper-test",
      "full_name": "Cloudoki/cn-hyper-test",
      "owner": {
        "name": "Cloudoki",
        "email": "hello@cloudoki.com"
      },
      "private": true,
      "html_url": "https://github.com/Cloudoki/cn-hyper-test",
      "description": "Testing tool to Restul API's, part of the Hyper platform",
      "fork": false,
      "url": "https://github.com/Cloudoki/cn-hyper-test",
      "forks_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/forks",
      "keys_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/teams",
      "hooks_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/hooks",
      "issue_events_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/issues/events{/number}",
      "events_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/events",
      "assignees_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/assignees{/user}",
      "branches_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/branches{/branch}",
      "tags_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/tags",
      "blobs_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/languages",
      "stargazers_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/stargazers",
      "contributors_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/contributors",
      "subscribers_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/subscribers",
      "subscription_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/subscription",
      "commits_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/contents/{+path}",
      "compare_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/compare/{base}…{head}",
      "merges_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/merges",
      "archive_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/downloads",
      "issues_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/issues{/number}",
      "pulls_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/labels{/name}",
      "releases_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/releases{/id}",
      "deployments_url": "https://api.github.com/repos/Cloudoki/cn-hyper-test/deployments",
      "created_at": 1464877710,
      "updated_at": "2016-06-02T16:54:14Z",
      "pushed_at": 1465378284,
      "git_url": "git://github.com/Cloudoki/cn-hyper-test.git",
      "ssh_url": "git@github.com:Cloudoki/cn-hyper-test.git",
      "clone_url": "https://github.com/Cloudoki/cn-hyper-test.git",
      "svn_url": "https://github.com/Cloudoki/cn-hyper-test",
      "homepage": null,
      "size": 53,
      "stargazers_count": 0,
      "watchers_count": 0,
      "language": "JavaScript",
      "has_issues": true,
      "has_downloads": true,
      "has_wiki": true,
      "has_pages": false,
      "forks_count": 0,
      "mirror_url": null,
      "open_issues_count": 0,
      "forks": 0,
      "open_issues": 0,
      "watchers": 0,
      "default_branch": "master",
      "stargazers": 0,
      "master_branch": "master",
      "organization": "Cloudoki"
    },
    "pusher": {
      "name": "efmr",
      "email": "edgar.marques.ribeiro@gmail.com"
    },
    "organization": {
      "login": "Cloudoki",
      "id": 12516144,
      "url": "https://api.github.com/orgs/Cloudoki",
      "repos_url": "https://api.github.com/orgs/Cloudoki/repos",
      "events_url": "https://api.github.com/orgs/Cloudoki/events",
      "hooks_url": "https://api.github.com/orgs/Cloudoki/hooks",
      "issues_url": "https://api.github.com/orgs/Cloudoki/issues",
      "members_url": "https://api.github.com/orgs/Cloudoki/members{/member}",
      "public_members_url": "https://api.github.com/orgs/Cloudoki/public_members{/member}",
      "avatar_url": "https://avatars.githubusercontent.com/u/12516144?v=3",
      "description": "We build cloud-based API’s, hybrid or native mobile apps, web applications, and do deep-level social media integration."
    },
    "sender": {
      "login": "efmr",
      "id": 11738330,
      "avatar_url": "https://avatars.githubusercontent.com/u/11738330?v=3",
      "gravatar_id": "",
      "url": "https://api.github.com/users/efmr",
      "html_url": "https://github.com/efmr",
      "followers_url": "https://api.github.com/users/efmr/followers",
      "following_url": "https://api.github.com/users/efmr/following{/other_user}",
      "gists_url": "https://api.github.com/users/efmr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/efmr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/efmr/subscriptions",
      "organizations_url": "https://api.github.com/users/efmr/orgs",
      "repos_url": "https://api.github.com/users/efmr/repos",
      "events_url": "https://api.github.com/users/efmr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/efmr/received_events",
      "type": "User",
      "site_admin": false
    }
  }],
  // Dredd results will be injected here
  "results": []
}

const fs = require('fs')
const path = require('path')

const handlebars = require('handlebars')
const juice = require('juice')
const helperMomentTimezone = require('./helper-moment-timezone')()

const css = fs.readFileSync(path.join(__dirname, '../views/mail.css'), 'utf8')
const source = fs.readFileSync(path.join(__dirname, '../views/mail.hbs'), 'utf8')

const template = handlebars.compile(source)
// https://github.com/helpers/handlebars-helper-moment
handlebars.registerHelper('moment', helperMomentTimezone.moment)
handlebars.registerHelper('duration', helperMomentTimezone.duration)

exports = module.exports = {}

exports.build = function build (gitPush, dreddResults) {
  let output = {
    payload: result.payloads[0],
    results: dreddResults
  }

  return output
}

exports.toHtml = function toHtml (gitPush, dreddResults) {
  let data = exports.build(gitPush, dreddResults);

  let html = juice.inlineContent(template(data), css)

  return html;
}